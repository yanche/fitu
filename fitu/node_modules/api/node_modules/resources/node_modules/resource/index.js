
var bluebird = require('bluebird');
var extension = require('extension');
var constants = require('const');

var Resource = function (webreq) {
    this.verb = webreq._raw.method;
    this.operator = webreq.user;
    this.args = webreq.body ? webreq.body.parsed : null;
    this.filter = {};
    this.badFilter = false;
};

Resource.prototype._accessibility = function () {
    return bluebird.resolve(['OPTIONS']);
};

Resource.prototype.fire = function () {
    switch (this.verb) {
        case 'OPTIONS':
            return this._options();
        case 'GET':
            return this._get();
        case 'POST':
            return this._post();
        case 'DELETE':
            return this._delete();
        default:
            return extension.http.webres405();
    }
};

Resource.prototype._options = function () {
    return this._accessibility()
    .then(function (httpOptions) {
        return extension.http.webres200(constants.mime.plain, '', { Allow: httpOptions.getAllowed().join(', ') });
    });
};

Resource.prototype._get = function () {
    return extension.http.webres405();
};

Resource.prototype._post = function () {
    return extension.http.webres405();
};

Resource.prototype._delete = function () {
    return extension.http.webres405();
};

module.exports = Resource;
