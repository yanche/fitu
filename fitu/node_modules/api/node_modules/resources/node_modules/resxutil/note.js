
var resxutil = require('resxutil');
var db = require('dbaccess');
var bluebird = require('bluebird');

exports.getFields = { '_id': 1, 'type': 1, 'authorId': 1, 'createdOn': 1, 'recipients': 1, 'subject': 1, 'content': 1, 'emphasis': 1 };
exports.convNoteInfo = function (note, relatedUsers) {
    var ret = { id: note._id.toString(), type: note.type, createdOn: note.createdOn, subject: note.subject, content: note.content, emphasis: note.emphasis };
    var author = relatedUsers.filter(function (ah) { return ah._id.equals(note.authorId); })[0];
    ret.author = author ? resxutil.user.convRelatedUserInfo(author) : null;
    var recipients = [];
    note.recipients.forEach(function (rid) {
        var recp = relatedUsers.filter(function (user) { return user._id.equals(rid); })[0];
        if (recp)
            recipients.push(recp);
    });
    ret.author = author ? resxutil.user.convRelatedUserInfo(author) : null;
    ret.recipients = recipients;
    return ret;
};