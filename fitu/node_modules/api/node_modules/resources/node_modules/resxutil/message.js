
var resxutil = require('resxutil');
var db = require('dbaccess');
var bluebird = require('bluebird');

exports.getFields = { '_id': 1, 'targetType': 1, 'targetId': 1, 'words': 1, 'authorId': 1, 'replyToUserId': 1, 'replyToMsgId': 1, 'createdOn': 1, 'like': 1 };
exports.convMsgInfo = function (msg, relatedUsers, selfObjId) {
    var ret = { id: msg._id.toString(), targetType: msg.targetType, targetId: msg.targetId.toString(), words: msg.words, createdOn: msg.createdOn, replyToMsgId: msg.replyToMsgId ? msg.replyToMsgId.toString() : null };
    var author = relatedUsers.filter(function (ah) { return ah._id.equals(msg.authorId); })[0];
    ret.author = author ? resxutil.user.convRelatedUserInfo(author) : null;
    var replyTo = msg.replyToUserId ? relatedUsers.filter(function (ah) { return ah._id.equals(msg.replyToUserId); })[0] : null;
    ret.replyToUser = replyTo ? resxutil.user.convRelatedUserInfo(replyTo) : null;
    ret.like = { count: msg.like.length, me: selfObjId ? msg.like.some(function (lk) { return lk.equals(selfObjId); }) : false };
    return ret;
};