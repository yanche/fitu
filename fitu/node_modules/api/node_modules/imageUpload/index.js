
var fileclient = require('fileclient');
var bluebird = require('bluebird');
var validate = require('validate');
var extension = require('extension');

var uploadOneImageOrByPass = function (obj, prop, subfolder) {
    if (validate.picBase64(obj[prop])) {
        var imageFormat = extension.image.getImageUploadFormat(obj[prop]);
        return fileclient.uploadImage([{ data: imageFormat.data, mime: imageFormat.mime, subfolder: subfolder }])
        .then(function (urls) {
            obj[prop] = urls[0];
            return obj;
        });
    }
    else
        return bluebird.resolve(obj);
};

exports.uploadOneImageOrByPass = uploadOneImageOrByPass;
