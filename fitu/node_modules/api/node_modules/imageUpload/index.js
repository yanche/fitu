
var fileclient = require('fileclient');
var bluebird = require('bluebird');
var validate = require('validate');
var extension = require('extension');
var es = require('externalstorage');

var uploadOneImageOrByPass = function (obj, prop, subfolder) {
    if (validate.picBase64(obj[prop])) {
        var imageFormat = extension.image.getImageUploadFormat(obj[prop]);
        return es.saveFile(new Buffer(imageFormat.data, 'base64'), 'test.' + imageFormat.mime.split('/')[1], 'testfolder')
        .then(function (ret) {
            obj[prop] = ret.path;
            return obj;
        });
    }
    else
        return bluebird.resolve(obj);
};

exports.uploadOneImageOrByPass = uploadOneImageOrByPass;
