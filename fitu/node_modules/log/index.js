
var Farm = require('./farm.js');
var farm = new Farm(1);
//var farm = new require('./farm.js')(10);
var LogEntry = require('./entry.js');
var constants = require('const');
var extension = require('extension');

var log = function (options) {
    farm.plant(new LogEntry(options));
};

var refineLog = function (headers, body) {
    if (!body) {
        body = headers;
        headers = {};
    }
    else {
        headers = headers || {};
    }
    headers.insertedOn = extension.datetime.chinaNow();
    return { headers: headers, body: body };
};

var logFactory = function (level) {
    return function (headers, body) {
        var logData = refineLog(headers, body);
        logData.level = level;
        log(logData);
    };
};

module.exports = {
    critical: logFactory(constants.loglevel.critical),
    error: logFactory(constants.loglevel.error),
    warn: logFactory(constants.loglevel.warn),
    info: logFactory(constants.loglevel.info),
    debug: logFactory(constants.loglevel.debug),
};