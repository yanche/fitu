
var Farm = require('./farm.js');
var config = require('config');
var LogEntry = require('./entry.js');
var constants = require('const');
var extension = require('extension');
var farm = new Farm(config.logTimeoutInSeconds);

var log = function (options) {
    farm.plant(new LogEntry(options));
};

var refineLog = function (headers, body) {
    if (!body) {
        body = headers;
        headers = {};
    }
    else {
        headers = headers || {};
    }
    headers.insertedOn = extension.datetime.chinaNow();
    return { headers: headers, body: body };
};

var logFactory = function (level, cut) {
    return function (headers, body) {
        var logData = refineLog(headers, body);
        logData.level = level;
        log({ data: logData, cut: cut });
    };
};

module.exports = {
    critical: logFactory(constants.loglevel.critical),
    error: logFactory(constants.loglevel.error),
    warn: logFactory(constants.loglevel.warn),
    info: logFactory(constants.loglevel.info),
    debug: logFactory(constants.loglevel.debug, true),
};