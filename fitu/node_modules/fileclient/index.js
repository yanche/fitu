
var http = require('http');
var config = require('config');
var bluebird = require('bluebird');
var extension = require('extension');

//input: [{'data':, 'type':, 'subfolder': }]
//output: ['url1', 'url2', ...]
var uploadImage = function (images) {
    var defer = new bluebird.defer();
    var req = http.request({
        'hostname': config.imageUploaderServer.hostname,
        'port': config.imageUploaderServer.port,
        'path': '/upload?token=' + config.uploadFileToken,
        'method': 'POST',
        'headers': {
            'Content-Type': 'application/json'
        }
    }, function (res) {
        extension.http.getRawBody(res)
        .then(function (rawbody) {
            defer.resolve(JSON.parse(rawbody.toString()));
        })
        .catch(function (err) {
            defer.reject(err);
        });
    });
    req.end(JSON.stringify(images));
    return defer.promise;
};

exports.uploadImage = uploadImage;
