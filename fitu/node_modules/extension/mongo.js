
var mongodb = require('mongodb');
var _ = require('underscore');
var validate = require('validate');

var tryConvObjId = function (id) {
    if (!id)
        return null;
    else {
        try {
            return new mongodb.ObjectID(id);
        }
        catch (err) {
            return null;
        }
    }
};

//no DOT.!!!
var pojo2mongoSet = function (pojo, father) {
    var ret = {};
    for (var i in pojo) {
        if (!validate.isObj(pojo[i]) || (pojo[i] instanceof mongodb.ObjectID))
            ret[father ? (father + '.' + i) : i] = pojo[i];
        else {
            var child = pojo2mongoSet(pojo[i], i);
            for (var j in child)
                ret[father ? (father + '.' + j) : j] = child[j];
        }
    }
    return ret;
};

exports.tryConvObjId = tryConvObjId;
exports.pojo2mongoSet = pojo2mongoSet;
