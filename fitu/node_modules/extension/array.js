
var mongoExt = require('./mongo.js');

var uniqueObjIdArray = function (arr) {
    var ret = [];
    for (var i = 0; i < arr.length; ++i) {
        var objid = mongoExt.tryConvObjId(arr[i]);
        if (objid && ret.every(function (v) { return !v.equals(objid); })) {
            ret.push(objid);
        }
    }
    return ret;
};

var sortFnFactory = function (valFn, asc) {
    return function (v1, v2) {
        return (asc ? 1 : -1) * (valFn(v1) - valFn(v2));
    };
};

var sortByCreatedon_desc = sortFnFactory(function (v) {
    var d = (v && v.createdOn && new Date(v.createdOn)) || new Date();
    d = d.getTime();
    return isNaN(d) ? 0 : d;
}, false);

exports.uniqueObjIdArray = uniqueObjIdArray;
exports.sortByCreatedon_desc = sortByCreatedon_desc;
