
var moment = require('moment');
var timezone = require('moment-timezone');

//in seconds, to 00:00:00, return 0 if current time is between 00:00:00 and 1:00:00
var getFileMaxAge = function () {
    var fileMaxAge = 0, now = moment().tz('Asia/Shanghai'); //China local time;
    if (now.hour() != 0) { //not in 00:00 - 00:59
        var endOfNow = now.clone().hour(24).minute(0).second(0); //end of today, 00:00:00 of next day
        fileMaxAge = (endOfNow - now) / 1000; //in seconds
    }
    return fileMaxAge;
};

var chinaNow = function (format) {
    var now = moment().tz('Asia/Shanghai');
    return now.format(format || 'YYYY/MM/DD HH:mm:ss:SSS');
};

//ref
//millis
//seconds
//minutes
//hours
//days
var getDateWithOffset = function (opt) {
    var ret = opt.ref ? new Date(opt.ref) : new Date();
    if (opt && opt.millis) ret.setMilliseconds(ret.getMilliseconds() + opt.millis);
    if (opt && opt.seconds) ret.setSeconds(ret.getSeconds() + opt.seconds);
    if (opt && opt.minutes) ret.setMinutes(ret.getMinutes() + opt.minutes);
    if (opt && opt.hours) ret.setHours(ret.getHours() + opt.hours);
    if (opt && opt.days) ret.setDate(ret.getDate() + opt.days);
    return ret;
};

exports.getFileMaxAge = getFileMaxAge;
exports.chinaNow = chinaNow;
exports.getDateWithOffset = getDateWithOffset;