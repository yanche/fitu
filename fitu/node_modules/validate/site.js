
var validate = require('validate');
var constants = require('const');

var validateAndAdjustSiteOpen = function (open) {
    if (!open || !open.startsOn || !open.endsOn)
        return false;
    var startH = Number(open.startsOn.hour), endH = Number(open.endsOn.hour);
    if (isNaN(startH) || startH < 0 || startH >= 24 || isNaN(endH) || endH < 0 || endH >= 24)
        return false;
    var startM = Number(open.startsOn.min), endM = Number(open.endsOn.min);
    if (isNaN(startM) || startM < 0 || startM >= 60 || isNaN(endM) || endM < 0 || endM >= 60)
        return false;
    if (startH * 60 + startM >= endH * 60 + endM)
        return false;
    return { startsOn: { hour: startH, min: startM }, endsOn: { hour: endH, min: endM } };
};

var validateAndAdjustSitePrices = function (prices) {
    if (validate.value(prices)) {
        if (!Array.isArray(prices))
            return false;
    }
    else
        return [];
    var ret = [];
    for (var i = 0; i < prices.length; ++i) {
        var price = prices[i];
        if (!price || !price.freq)
            return false;
        var amount = Number(price.amount), freqNum = Number(price.freq.num), freqMeasure = price.freq.measure, people = Number(price.people), comments = price.comments || '';
        if (isNaN(amount) || amount < 0 || isNaN(freqNum) || freqNum <= 0 || isNaN(people) || people <= 0 || !constants.site.validPriceMeasure(freqMeasure) || !validate.isString(comments))
            return false;
        ret.push({ amount: amount, freq: { num: freqNum, measure: freqMeasure }, people: people, comments: comments });
    }
    return ret;
};

exports.validateAndAdjustOpen = validateAndAdjustSiteOpen;
exports.validateAndAdjustPrices = validateAndAdjustSitePrices;